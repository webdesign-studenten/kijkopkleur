<?php

/**

*

* Do not edit or add to this file if you wish to upgrade the module to newer

* versions in the future. If you wish to customize the module for your

* needs please contact us to https://www.milople.com/contact-us.html

*

* @category    Ecommerce

* @package     Milople_VATExempt

* @copyright   Copyright (c) 2017 Milople Technologies Pvt. Ltd. All Rights Reserved.

* @url         https://www.milople.com/magento-extensions/vat-exempt-m2.html

*

**/ 



?>

<?php /** @var $block \Magento\Sales\Block\Order\Info */ ?>

<?php $_order = $block->getOrder() ?>

<?php $vatHelper=$this->helper('Milople\Vatexempt\Helper\Data'); ?>

<?php 

$vatOrderData= $vatHelper->getVatOrderDetail($_order->getIncrementId());

$count=count($vatOrderData);

?>

<div class="block block-order-details-view">

    <div class="block-title">

        <strong><?php /* @escapeNotVerified */ echo __('Order Information') ?></strong>

    </div>

    <div class="block-content">

    <?php if (!$_order->getIsVirtual()): ?>

        <div class="box box-order-shipping-address">

            <strong class="box-title"><span><?php /* @escapeNotVerified */ echo __('Shipping Address') ?></span></strong>

            <div class="box-content">

                <address><?php /* @escapeNotVerified */ echo $block->getFormattedAddress($_order->getShippingAddress()); ?></address>

            </div>

        </div>



        <div class="box box-order-shipping-method">

            <strong class="box-title">

                <span><?php /* @escapeNotVerified */ echo __('Shipping Method') ?></span>

            </strong>

            <div class="box-content">

            <?php if ($_order->getShippingDescription()): ?>

                <?php echo $block->escapeHtml($_order->getShippingDescription()) ?>

            <?php else: ?>

                <?php /* @escapeNotVerified */ echo __('No shipping information available'); ?>

            <?php endif; ?>

            </div>

        </div>

    <?php endif; ?>



        <div class="box box-order-billing-address">

            <strong class="box-title">

                <span><?php /* @escapeNotVerified */ echo __('Billing Address') ?></span>

            </strong>

            <div class="box-content">

                <address><?php /* @escapeNotVerified */ echo $block->getFormattedAddress($_order->getBillingAddress()); ?></address>

            </div>

        </div>

        <div class="box box-order-billing-method">

            <strong class="box-title">

                <span><?php /* @escapeNotVerified */ echo __('Payment Method') ?></span>

            </strong>

            <div class="box-content">

                <?php echo $block->getPaymentInfoHtml() ?>

            </div>

        </div>

    </div>

</div>

<?php if($count>=1): ?>

<div class="block block-order-details-view">

    <div class="block-title">

        <strong><?php  echo __('VAT Exempt Information'); ?></strong>

    </div>

    <div class="admin__table-wrapper">

    <table class="data-table admin__table-primary edit-order-table">

        <thead>

            <tr class="headings">

                <th class="col-product"><span>Product</span></th>

                <th class="col-status"><span>Claimer Name</span></th>

                <th class="col-price-original"><span>Reason</span></th>
                <?php foreach($vatOrderData as $data): ?>
                
                <?php if($data->getFile()){ ?>
                        <th class="col-dwd"><span>Download</span></th>
                <?php } ?>
                
                <?php endforeach; ?>    
            </tr>

        </thead>

        <tbody class="even">

           <?php foreach($vatOrderData as $data): ?>

            <tr>

                <td class="col-product">

                    <div id="order_item_<?php echo $data->getDetailId(); ?>">

                        <div id="order_item_<?php echo $data->getDetailId(); ?>_title" class="product-title">

                            <?php echo $data->getProductName(); ?></div>



                        <div class="product-sku-block">

                            <span>SKU:</span> <?php echo $data->getProductName(); ?> </div>



                    </div>

                </td>

                <td class="col-status"><?php echo $data->getApplicantName(); ?></td>

                <td class="col-price-original"><span class="price"><?php echo  $vatHelper->getConditionName($data->getConditionId()); ?></span>

                </td>
                <?php if($data->getFile()){ ?>
                    <td class="col-dwd"><a href="<?php echo $block->getUrl('vatexempt/conditions/download/',['detail_id'=>$data->getDetailId()]);?>">Download</a></td>
               <?php } ?>
                


            </tr>

        <?php endforeach; ?>  



        </tbody>

    </table>

  </div>	<!-- Table Container -->

</div>

<?php endif; ?>

